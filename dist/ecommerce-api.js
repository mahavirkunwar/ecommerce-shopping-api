(()=>{"use strict";var e={64:(e,t,n)=>{var r=n(860),s=n.n(r);const i=require("dotenv");var o=n.n(i);const a=require("nocache");var u=n.n(a);const c=require("http");var l=n.n(c);const d=require("path");var f=n.n(d);const p=require("cors");var h=n.n(p);const y=require("sequelize");var v=n.n(y);const b=function(e,t){var n=e.define("orders",{id:{primaryKey:!0,allowNull:!1,type:t.UUID,defaultValue:t.UUIDV4},user_id:{allowNull:!1,type:t.UUID},product_id:{allowNull:!1,type:t.UUID},address:{allowNull:!1,type:t.STRING}},{underscored:!0,tableName:"orders",timestamps:!0});return n.associate=function(e){n.belongsTo(e.products,{foreignKey:"product_id",as:"productDetails"}),n.belongsTo(e.users,{foreignKey:"user_id",as:"userDetails"})},n},m=function(e,t){return e.define("products",{id:{primaryKey:!0,allowNull:!1,type:t.UUID,defaultValue:t.UUIDV4},title:{allowNull:!1,type:t.STRING(255)},photo_name:{allowNull:!0,type:t.STRING(255)},description:{allowNull:!0,type:t.STRING(1e3)}},{underscored:!0,tableName:"products",timestamps:!0})},w=new function e(){var t,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n=function(){return new Promise((function(e){var t,n,r=new(v())(process.env.DB_DATABASE,process.env.DB_USERNAME,process.env.DB_PASSWORD,{host:process.env.DB_HOST,dialect:process.env.DB_DIALECT,operatorsAliases:0,pool:{max:5,min:0,acquire:3e4,idle:1e4}}),s={users:(t=r,n=v(),t.define("users",{id:{primaryKey:!0,allowNull:!1,type:n.UUID,defaultValue:n.UUIDV4},email:{allowNull:!1,type:n.STRING(100),validate:{isEmail:!0}},password:{allowNull:!1,type:n.STRING(255)}},{underscored:!0,tableName:"users",timestamps:!0})),orders:b(r,v()),products:m(r,v())};Object.keys(s).forEach((function(e){s[e].associate&&s[e].associate(s)})),s.Sequelize=v(),s.connection=r,e(s)}))},(t="dbConnect")in this?Object.defineProperty(this,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):this[t]=n,o().config()};var g=n(17),A=["message"];function O(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}new function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),O(this,"configureApp",(function(e){return new Promise((function(t,n){var r=s()();r.use(h()()),r.use(u()()),r.use(s().json()),r.use(s().urlencoded({extended:!0})),r.use(s().static(f().join(__dirname,"public"))),r.use("/",g.Z),r.use((function(e,t,n){return t.status(404).send({error:"Not found: ".concat(e.url)})})),r.use((function(e,t,n,r){var s=e.status||500,i=e.message,o=function(e,t){if(null==e)return{};var n,r,s=function(e,t){if(null==e)return{};var n,r,s={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(s[n]=e[n]);return s}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}(e,A),a=Object.keys(o).length?Object.values(o):{error:i};return n.status(s).send(a)})),global.db=e,global.rootDir=f().resolve(__dirname),t(r)}))})),O(this,"startServer",(function(e){return new Promise((function(t,n){var r=process.env.PORT;e.set("port",r);var s=l().createServer(e);s.on("listening",(function(){var e=s.address().port;console.log("Ecommerce API listening on "+"http://localhost:".concat(e))})),s.listen(r),t(s)}))})),o().config(),w.dbConnect().then((function(e){return t.configureApp(e)})).then((function(e){return t.startServer(e)}))}},17:(e,t,n)=>{n.d(t,{Z:()=>E});var r=n(860),s=n.n(r);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const o=new function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),i(this,"findAll",(function(e,n){return e&&n?t.findManyByAttr({id:e,user_id:n}):n?t.findManyByAttr({user_id:n}):t.findManyByAttr()})),i(this,"findManyByAttr",(function(e){return db.orders.findAll({where:e,include:[{association:"productDetails",attributes:["title","description","price","photo_name"]},{association:"userDetails",attributes:["email"]}]})})),i(this,"createOrder",(function(e){return db.orders.create(e)}))},a=require("http-errors");var u=n.n(a);const c=function(e,t,n){var r=e.body,s=r.address,i=r.user_id,a=r.product_id;if(!s||""==s||!a||!i)throw u()(400);return o.createOrder(r).then((function(e){t.status(200).send(e)})).catch(n)},l=function(e,t,n){var r=e.params.id,s=e.query.userId;return o.findAll(r,s).then((function(e){0==e.length&&r?t.status(404).send():r?t.status(200).send(e[0]):t.status(200).send(e)})).catch(n)};var d=s().Router();d.post("/create",c),d.get("/:id?",l);const f=d;function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const h=new function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),p(this,"findAll",(function(e){return e?t.findManyByAttr({id:e}):t.findManyByAttr()})),p(this,"findManyByAttr",(function(e){var t=db.products,n=["product_name"].DESC;return t.findAll({where:e,order:n})})),p(this,"createProduct",(function(e){return db.products.create(e)}))},y=function(e,t,n){var r=e.body;return h.createProduct(r).then((function(e){t.status(200).send(e)})).catch(n)},v=function(e,t,n){var r=e.params.id;return h.findAll(r).then((function(e){0==e.length&&r?t.status(404).send():r?t.status(200).send(e[0]):t.status(200).send(e)})).catch(n)};var b=s().Router();b.post("/create",y),b.get("/:id?",v);const m=b;function w(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const g=new function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),w(this,"findAll",(function(e){return e?t.findManyByAttr({id:e}):t.findManyByAttr()})),w(this,"findManyByAttr",(function(e){return db.users.findAll({where:e,order:["id"]})})),w(this,"findOneByAttr",(function(e){return db.users.findOne({where:e})})),w(this,"checkUser",(function(e,n){return t.findOneByAttr({email:e,password:n})})),w(this,"findOneByEmail",(function(e){return t.findOneByAttr({email:e})})),w(this,"createUser",(function(e){return db.users.create(e)}))},A=require("jsonwebtoken");var O=n.n(A);function _(e){return O().sign(e,process.env.JWT_SECRET,{expiresIn:process.env.JWT_EXPIRY})}const D=function(e,t,n){var r=e.body,s=r.email,i=r.password;return g.checkUser(s,i).then((function(e){if(!e)throw u()(403);var n=_({user:e}),r=e.id,s=e.email;t.status(200).send({token:n,info:{id:r,email:s}})})).catch(n)},N=function(e,t,n){var r=e.body,s=r.email,i=r.password;return g.findOneByEmail(s).then((function(e){if(e)throw u()(409);var t={email:s,password:i};return g.createUser(t)})).then((function(e){var n=_({user:e}),r=e.id,s=e.email;t.status(200).send({token:n,info:{id:r,email:s}})})).then((function(e){t.status(200).send(e)})).catch(n)},U=function(e,t,n){var r=e.params.id;return g.findAll(r).then((function(e){if(0==e.length&&r)throw u()(404);t.status(200).send(e)})).catch(n)};var B=s().Router();B.post("/signin",D),B.post("/signup",N),B.get("/:id?",U);const I=B;var T=s().Router();T.get("/",(function(e,t){return t.send("This is base {/index} API. Use the respective routes to begin.")})),T.use("/orders",f),T.use("/products",m),T.use("/users",I);const E=T},478:e=>{e.exports=require("babel-polyfill")},860:e=>{e.exports=require("express")}},t={};function n(r){var s=t[r];if(void 0!==s)return s.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n(478),n(64),n(17)})();